---
title: "Reaction Time"
output: html_document
date: "2022-10-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

####################################################################################################################################

Statistical analysis of Reaction Time in the ADAPT-PD behavioural task

```{r }
rm(list = ls())
library(emmeans)
library(gdata)
library(lme4)
library(ggplot2)
library(lmerTest)
library(cowplot)
library(readxl)
library(magrittr) # needs to be run every time you start R and want to use %>%
library(dplyr)    # alternatively, this also loads %>%
library(rstatix)
dat =read_excel('C:/Users/leano/OneDrive/Documents/DRCMR/ADAPT Behavioural Study Vytautas/behavioral_output_final.xlsx')

#Determine factor (cat) variables
dat$SubjectNr = factor(dat$SubjectNr)
dat$Gender = factor(dat$Gender)
dat$Run = factor(dat$Run)
dat$FaceGender = factor(dat$FaceGender)
dat$FaceEmotion = factor(dat$FaceEmotion)
dat$RewardPromise = factor(dat$RewardPromise)

#Include only cases with correct response, no missing data, RT between 0.2 and 1.0 seconds
dfCorrect = dat[dat$Correct==1 & is.na(dat$RT_init)==FALSE & dat$RT_init>.2 & dat$RT_init<1,]
```

ANOVA checking effects of facegender, faceemotion and reward promise on RT
Expectations:
 - effect of face emotions (non-neutral emotion is distracting -> slower RT)
 - effect of reward promise (high reward -> faster reaction times)
 - interaction between facee

```{r }
modelRT <- lmer(RT_init ~ FaceGender*FaceEmotion*RewardPromise + (1 | SubjectNr),data=dfCorrect)
anova(modelRT)
```

When correct answers were given
-> Interaction effect of FaceGender and FaceEmotion
-> Tendency in RewardPromise

First I plot FaceGender against FaceEmotion on RT

````{r }
ggplot(data = dfCorrect, mapping = aes(x = FaceEmotion, y = RT_init, fill=FaceGender)) +
  geom_boxplot()
````

Testing simple effects of facegender & faceemotion interaction

````{r }
emmeans(
  modelRT,
  effect = c("FaceGender","FaceEmotion"),
  by = NULL,
  contrast = "pairwise",
  reverse = TRUE,
  p.adjust = "bonferroni",
  sd.pooled = NULL,
  model.type = "multivariate",
  pbkrtest.limit = 6078
)
````

````{r }

````

Single comparison with just one factor

````{r }
v1 <- sd(dfCorrect$RT_init [dfCorrect$FaceGender == 1])^2
v2 <- sd(dfCorrect$RT_init [dfCorrect$FaceGender == 2])^2

test <- t.test_knownvar(dfCorrect$RT_init [dfCorrect$FaceGender == 1],
                        dfCorrect$RT_init [dfCorrect$FaceGender == 2],
                        V1 = v1, V2 = v2
)
test
````

This seems to complicated to have to do many many times to get each comparison
Also so far only includes one factor

```` {r }
pairwise.t.test(dfCorrect$RT_init, dfCorrect$FaceGender ~ dfCorrect$FaceEmotion, p.adj='bonferroni')
````

No idea what this error means
Bac kto trying EMMEANS

````{r }
emmeans(df$Correct, ~ FaceEmotion*FaceGender); pairs(emm, by = “FaceEmotion”); pairs(emm, by = “FaceGender”)

````

trying something else

````{r }

t.test_knownvar <- function(x, y, V1, V2, m0 = 0, alpha = 0.05, alternative = "two.sided"){
  M1 <- mean(x)
  M2 <- mean(y)
  n1 <- length(x)
  n2 <- length(y)
  sigma1 <- sqrt(V1)
  sigma2 <- sqrt(V2)
  S <- sqrt((V1 / n1) + (V2 / n2))
  statistic <- (M1 - M2 - m0) / S
  p <- if (alternative == "two.sided") {
    2 * pnorm(abs(statistic), lower.tail = FALSE)
  } else if (alternative == "less") {
    pnorm(statistic, lower.tail = TRUE)
  } else {
    pnorm(statistic, lower.tail = FALSE)
  }
  LCL <- (M1 - M2 - S * qnorm(1 - alpha / 2))
  UCL <- (M1 - M2 + S * qnorm(1 - alpha / 2))
  value <- list(mean1 = M1, mean2 = M2, m0 = m0, sigma1 = sigma1, sigma2 = sigma2, S = S, statistic = statistic, p.value = p, LCL = LCL, UCL = UCL, alternative = alternative)
  return(value)
}
````

````{r }
summary(dfCorrect$FaceGender[dfCorrect$FaceEmotion == -1])
summary(dfCorrect$FaceGender[dfCorrect$FaceEmotion == 0])
summary(dfCorrect$FaceGender[dfCorrect$FaceEmotion == 1])
````
````{r }
t.test_knownvar(dfCorrect$FaceEmotion[dfCorrect$FaceGender == 1], dfCorrect$RT_init,
                V1 = )

````

